(this["webpackJsonpreact_dynamic-list-of-posts"]=this["webpackJsonpreact_dynamic-list-of-posts"]||[]).push([[0],{13:function(e,t,s){},15:function(e,t,s){},16:function(e,t,s){"use strict";s.r(t);var c=s(6),a=s.n(c),n=s(3),o=s(2),r=(s(11),s(12),s(13),s(4)),i=s.n(r),l=s(1),d="https://mate.academy/students-api";function m(e){return new Promise((function(t){setTimeout(t,e)}))}function j(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"GET",s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,c={method:t};return s&&(c.body=JSON.stringify(s),c.headers={"Content-Type":"application/json; charset=UTF-8"}),m(300).then((function(){return fetch(d+e,c)})).then((function(e){return e.json()}))}var u=function(e){return j(e)},b=function(e,t){return j(e,"POST",t)},O=function(e){return j(e,"DELETE")},p=s(0),h={selectedUser:null,activeList:!1,error:null,listPostsUser:[],load:{type:"",active:!1},selectedPost:null,commentsPost:[],activeForm:!1},v=function(e,t){switch(t.type){case"selectUser":return Object(l.a)(Object(l.a)({},e),{},{selectedUser:t.user});case"active":return Object(l.a)(Object(l.a)({},e),{},{activeList:t.show});case"error":return Object(l.a)(Object(l.a)({},e),{},{error:t.error});case"postsUser":return Object(l.a)(Object(l.a)({},e),{},{listPostsUser:t.posts});case"loadData":return Object(l.a)(Object(l.a)({},e),{},{load:t.objectLoad});case"selectPost":return Object(l.a)(Object(l.a)({},e),{},{selectedPost:t.post});case"commentsPost":return Object(l.a)(Object(l.a)({},e),{},{commentsPost:t.comments});case"activeForm":return Object(l.a)(Object(l.a)({},e),{},{activeForm:t.active});default:return e}},x=Object(o.createContext)([h,function(e){return e}]),y=function(e){var t=e.children,s=Object(o.useReducer)(v,h),c=Object(n.a)(s,2),a=c[0],r=c[1];return Object(p.jsx)(x.Provider,{value:[a,r],children:t})},f=function(){var e=Object(o.useContext)(x),t=Object(n.a)(e,2),s=t[0],c=t[1];Object(o.useEffect)((function(){var e;s.selectedUser&&(c({type:"loadData",objectLoad:{type:"postsUser",active:!0}}),(e=s.selectedUser.id,u("/posts?userId=".concat(e))).then((function(e){"error"in e?(c({type:"loadData",objectLoad:{type:"postsUser",active:!1}}),c({type:"error",error:Object(l.a)(Object(l.a)({},e),{},{type:"listPosts"})})):(c({type:"postsUser",posts:e}),c({type:"loadData",objectLoad:{type:"postsUser",active:!1}}))})))}),[s.selectedUser]);var a=Object(o.useMemo)((function(){return s.listPostsUser.map((function(e){return Object(p.jsxs)("tr",{"data-cy":"Post",children:[Object(p.jsx)("td",{"data-cy":"PostId",children:e.id}),Object(p.jsx)("td",{"data-cy":"PostTitle",children:e.body}),Object(p.jsx)("td",{className:"has-text-right is-vcentered",children:Object(p.jsx)("button",{type:"button","data-cy":"PostButton",className:i()("button is-link",{"is-light":s.selectedPost!==e}),onClick:function(){return function(e){s.selectedPost===e?(c({type:"selectPost",post:null}),c({type:"activeForm",active:!1})):(c({type:"selectPost",post:e}),c({type:"activeForm",active:!1}))}(e)},children:s.selectedPost===e?"Close":"Open"})})]},e.id)}))}),[s.listPostsUser,s.selectedPost]);return s.listPostsUser.length>0?Object(p.jsxs)("div",{"data-cy":"PostsList",children:[Object(p.jsx)("p",{className:"title",children:"Posts:"}),Object(p.jsxs)("table",{className:"table is-fullwidth is-striped is-hoverable is-narrow",children:[Object(p.jsx)("thead",{children:Object(p.jsxs)("tr",{className:"has-background-link-light",children:[Object(p.jsx)("th",{children:"#"}),Object(p.jsx)("th",{children:"Title"}),Object(p.jsx)("th",{children:" "})]})}),Object(p.jsx)("tbody",{children:a})]})]}):Object(p.jsx)(p.Fragment,{})},N=(s(15),function(){return Object(p.jsx)("div",{className:"Loader","data-cy":"Loader",children:Object(p.jsx)("div",{className:"Loader__content"})})}),P=function(e){var t=e.value,s=e.setValue,c=e.error,a=e.textError,n=e.title,o=e.valideFrom,r=e.setValidForm,l=e.type,d=e.placeholder,m=function(e){s(e.target.value);var t=Object.entries(o).map((function(e){return e[0]===l?[l,!0]:e}));r(Object.fromEntries(t))};return Object(p.jsxs)("div",{className:"field","data-cy":"NameField",children:[Object(p.jsx)("label",{className:"label",htmlFor:"comment-author-name",children:n}),"text"===l?Object(p.jsx)("div",{className:"control",children:Object(p.jsx)("textarea",{id:"comment-body",name:"body",placeholder:d,className:i()("textarea",{"is-danger":!c}),value:t,onChange:m})}):Object(p.jsxs)("div",{className:"control has-icons-left has-icons-right",children:[Object(p.jsx)("input",{type:"text",name:"name",id:"comment-author-name",placeholder:d,className:i()("input",{"is-danger":!c}),value:t,onChange:m}),Object(p.jsx)("span",{className:"icon is-small is-left",children:Object(p.jsx)("i",{className:"fas fa-user"})}),!c&&Object(p.jsx)("span",{className:"icon is-small is-right has-text-danger","data-cy":"ErrorIcon",children:Object(p.jsx)("i",{className:"fas fa-exclamation-triangle"})})]}),!c&&Object(p.jsx)("p",{className:"help is-danger","data-cy":"ErrorMessage",children:a})]})},g=function(e){var t=e.getComments,s=Object(o.useContext)(x),c=Object(n.a)(s,2),a=c[0],r=c[1],d=Object(o.useState)(""),m=Object(n.a)(d,2),j=m[0],u=m[1],O=Object(o.useState)(""),h=Object(n.a)(O,2),v=h[0],y=h[1],f=Object(o.useState)(""),N=Object(n.a)(f,2),g=N[0],C=N[1],U=Object(o.useState)({name:!0,email:!0,text:!0}),w=Object(n.a)(U,2),E=w[0],F=w[1],L=function(){u(""),y(""),C(""),F({name:!0,email:!0,text:!0})};return Object(p.jsxs)("form",{"data-cy":"NewCommentForm",onSubmit:function(e){e.preventDefault();var s,c=Object(l.a)({},E);j||(c.name=!1),v||(c.email=!1),g||(c.text=!1),Object.values(c).some((function(e){return!1===e}))||a.selectedPost&&a.selectedUser&&(r({type:"loadData",objectLoad:{type:"addComments",active:!0}}),(s={id:0,postId:a.selectedPost.id,name:j,email:v,body:g},b("/comments",s)).then((function(e){"message"in e&&(r({type:"error",error:Object(l.a)(Object(l.a)({},e),{},{type:"comments"})}),r({type:"loadData",objectLoad:{type:"addComments",active:!1}})),a.selectedPost&&(t(a.selectedPost.id),L(),r({type:"loadData",objectLoad:{type:"addComments",active:!1}}))}))),F(c)},children:[Object(p.jsx)(P,{value:j,setValue:u,error:E.name,textError:"Name is required",title:"Author Name",valideFrom:E,setValidForm:F,type:"name",placeholder:"Name Surname"}),Object(p.jsx)(P,{value:v,setValue:y,error:E.email,textError:"Email is required",title:"Author Email",valideFrom:E,setValidForm:F,type:"email",placeholder:"email@test.com"}),Object(p.jsx)(P,{value:g,setValue:C,error:E.text,textError:"Enter some text",title:"Comment Text",valideFrom:E,setValidForm:F,type:"text",placeholder:"Type comment here"}),Object(p.jsxs)("div",{className:"field is-grouped",children:[Object(p.jsx)("div",{className:"control",children:Object(p.jsx)("button",{type:"submit",className:i()("button is-link",{"is-loading":"addComments"===a.load.type&&a.load.active}),children:"Add"})}),Object(p.jsx)("div",{className:"control",children:Object(p.jsx)("button",{type:"reset",className:"button is-link is-light",onClick:L,children:"Clear"})})]})]})},C=function(){var e,t,s,c=Object(o.useContext)(x),a=Object(n.a)(c,2),r=a[0],i=a[1],d=function(e){(function(e){return u("/comments?postId=".concat(e))})(e).then((function(e){"error"in e?(i({type:"error",error:Object(l.a)(Object(l.a)({},e),{},{type:"comments"})}),i({type:"loadData",objectLoad:{type:"comments",active:!1}})):(i({type:"commentsPost",comments:e}),i({type:"loadData",objectLoad:{type:"comments",active:!1}}))}))};Object(o.useEffect)((function(){r.selectedPost&&(i({type:"loadData",objectLoad:{type:"comments",active:!0}}),d(r.selectedPost.id))}),[r.selectedPost]);var m=function(e){(function(e){return O("/comments/".concat(e))})(e).then((function(){r.selectedPost&&i({type:"commentsPost",comments:r.commentsPost.filter((function(t){return t.id!==e}))})}))},j=Object(o.useMemo)((function(){return r.activeForm?Object(p.jsx)(g,{getComments:d}):Object(p.jsx)("button",{"data-cy":"WriteCommentButton",type:"button",className:"button is-link",onClick:function(){return i({type:"activeForm",active:!0})},children:"Write a comment"})}),[r.activeForm]),b=Object(o.useMemo)((function(){var e;return Object(p.jsxs)(p.Fragment,{children:[Object(p.jsx)("p",{className:"title is-4",children:"Comments:"}),r.commentsPost.length<1&&Object(p.jsx)("p",{className:"title is-4","data-cy":"NoCommentsMessage",children:"No comments yet"}),r.commentsPost.map((function(e){return Object(p.jsxs)("article",{className:"message is-small","data-cy":"Comment",children:[Object(p.jsxs)("div",{className:"message-header",children:[Object(p.jsx)("a",{href:"mailto:".concat(e.email),"data-cy":"CommentAuthor",children:e.name}),Object(p.jsx)("button",{"data-cy":"CommentDelete",type:"button",className:"delete is-small","aria-label":"delete",onClick:function(){return m(e.id)},children:"delete button"})]}),Object(p.jsx)("div",{className:"message-body","data-cy":"CommentBody",children:e.body})]},e.id)})),"comments"===(null===(e=r.error)||void 0===e?void 0:e.type)&&Object(p.jsx)("div",{className:"notification is-danger","data-cy":"CommentsError",children:"Something went wrong"})]})}),[r.error,r.commentsPost]);return Object(p.jsxs)("div",{className:"content","data-cy":"PostDetails",children:[Object(p.jsxs)("div",{className:"block",children:[Object(p.jsx)("h2",{"data-cy":"PostTitle",children:"#".concat(null===(e=r.selectedPost)||void 0===e?void 0:e.id,": ").concat(null===(t=r.selectedPost)||void 0===t?void 0:t.title)}),Object(p.jsx)("p",{"data-cy":"PostBody",children:null===(s=r.selectedPost)||void 0===s?void 0:s.body})]}),Object(p.jsx)("div",{className:"block",children:"comments"===r.load.type&&r.load.active?Object(p.jsx)(N,{}):b}),j]})},U=function(){var e=Object(o.useState)([]),t=Object(n.a)(e,2),s=t[0],c=t[1],a=Object(o.useContext)(x),r=Object(n.a)(a,2),d=r[0],m=r[1];Object(o.useEffect)((function(){u("/users").then((function(e){"error"in e?m({type:"error",error:Object(l.a)(Object(l.a)({},e),{},{type:"listUsers"})}):c(e)}))}),[]);var j=Object(o.useMemo)((function(){return s.map((function(e){return Object(p.jsx)("a",{href:"#user-".concat(e.id),className:i()("dropdown-item",{"is-active":d.selectedUser===e}),onClick:function(){return function(e){e!==d.selectedUser&&(m({type:"selectUser",user:e}),m({type:"postsUser",posts:[]}),m({type:"error",error:null}),m({type:"selectPost",post:null})),m({type:"active",show:!1})}(e)},children:e.name},e.id)}))}),[s,d.selectedUser]);return Object(p.jsxs)("div",{"data-cy":"UserSelector",className:i()("dropdown",{"is-active":d.activeList}),children:[Object(p.jsx)("div",{className:"dropdown-trigger",children:Object(p.jsxs)("button",{type:"button",className:"button","aria-haspopup":"true","aria-controls":"dropdown-menu",onClick:function(){return m({type:"active",show:!d.activeList})},children:[Object(p.jsx)("span",{children:d.selectedUser?d.selectedUser.name:"Choose a user"}),Object(p.jsx)("span",{className:"icon is-small",children:Object(p.jsx)("i",{className:"fas fa-angle-down","aria-hidden":"true"})})]})}),Object(p.jsx)("div",{className:"dropdown-menu",id:"dropdown-menu",role:"menu",children:Object(p.jsx)("div",{className:"dropdown-content",children:j})})]})},w=function(){var e,t,s=Object(o.useContext)(x),c=Object(n.a)(s,2),a=c[0],r=c[1],l=function(e){e.target.parentNode&&"button"!==e.target.parentNode.className&&"icon is-small"!==e.target.parentNode.className&&"dropdown-trigger"!==e.target.parentNode.className&&r({type:"active",show:!1})};return Object(o.useEffect)((function(){document.addEventListener("click",l)}),[]),Object(p.jsx)("main",{className:"section",children:Object(p.jsx)("div",{className:"container",children:Object(p.jsxs)("div",{className:"tile is-ancestor",children:[Object(p.jsx)("div",{className:"tile is-parent",children:Object(p.jsxs)("div",{className:"tile is-child box is-success",children:[Object(p.jsx)("div",{className:"block",children:Object(p.jsx)(U,{})}),Object(p.jsxs)("div",{className:"block","data-cy":"MainContent",children:[!a.selectedUser&&Object(p.jsx)("p",{"data-cy":"NoSelectedUser",children:"No user selected"}),"postsUser"===a.load.type&&a.load.active&&Object(p.jsx)(N,{}),"listPosts"===(null===(e=a.error)||void 0===e?void 0:e.type)&&Object(p.jsx)("div",{className:"notification is-danger","data-cy":"PostsLoadingError",children:"Something went wrong!"}),"postsUser"===a.load.type&&!a.load.active&&a.listPostsUser.length<1&&"listPosts"!==(null===(t=a.error)||void 0===t?void 0:t.type)&&Object(p.jsx)("div",{className:"notification is-warning","data-cy":"NoPostsYet",children:"No posts yet"}),Object(p.jsx)(f,{})]})]})}),Object(p.jsx)("div",{"data-cy":"Sidebar",className:i()("tile","is-parent","is-8-desktop","Sidebar",{"Sidebar--open":a.selectedPost}),children:Object(p.jsx)("div",{className:"tile is-child box is-success ",children:a.selectedPost&&Object(p.jsx)(C,{})})})]})})})};a.a.render(Object(p.jsx)(y,{children:Object(p.jsx)(w,{})}),document.getElementById("root"))}},[[16,1,2]]]);
//# sourceMappingURL=main.11573a78.chunk.js.map